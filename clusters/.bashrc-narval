# ~/.bashrc: executed by bash(1) for non-login shells.

# Source global definitions
if [ -f /etc/bashrc ]; then
	. /etc/bashrc
fi

# User specific environment
if ! [[ "$PATH" =~ "$HOME/.local/bin:$HOME/bin:" ]]
then
    PATH="$HOME/.local/bin:$HOME/bin:$PATH"
fi
export PATH

# Uncomment the following line if you don't like systemctl's auto-paging feature:
# export SYSTEMD_PAGER=

# don't put duplicate lines or lines starting with space in the history.
# See bash(1) for more options
export HISTCONTROL=ignoreboth:erasedups

HISTIGNORE="&:ls:ll:exit:pwd:clear:mount:umount:?:??:history"

# append to the history file, don't overwrite it
shopt -s histappend

# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
export HISTSIZE=1000000
export HISTFILESIZE=1000000000

# save the commands for every session into the same source
export PROMPT_COMMAND='history -a'

HISTTIMEFORMAT=''       # Save the timestamp, but don't output it
#HISTTIMEFORMAT='%F_%T ' # output the time in 'history' see "ht" alias

# History Aliases...
h()  { history 30; }                          # last few history commands
ht() { HISTTIMEFORMAT='%F_%T  ' history 30; } # history with time stamps

# User specific aliases and functions
## General stuff
alias cp="cp -v --no-clobber"
alias mv="mv -v --no-clobber"

alias gs="git status"
git-update() {
    git fetch && git status
}

# some ls aliases
alias llt="ls -ahlFtr" #reverse time lookup (oldest last), w size prefixes
alias lla='ls -ahlF'
alias ll='ls -hlF'
alias la='ls -A'
alias l='ls -CF'

## narval specific
alias htopme="htop -u rabyj"

eval "$(thefuck --alias)" #fuck

export SLURM_TIME_FORMAT="%d %H:%M:%S"
export SACCT_FIELDS="JobID%8,JobName%30,Timelimit,Elapsed,NCPU%5,ReqMem%7,ExitCode,State%8,Priority%8,Submit%12,Account"
alias sqme="sacct -X --format=${SACCT_FIELDS}"
alias sqme2="squeue -u rabyj"

alias go-git="cd ~/project-rabyj/sources/epi_ml; ls; git-update"
alias go-epilap="cd ~/project-rabyj/epilap; ls"
alias go-sub="cd ~/project-rabyj/epilap/output/sub; ls"
alias go-logs="cd ~/project-rabyj/epilap/output/logs; ls"

# EpiLaP pyTorch
ml python/3.8
ml httpproxy

# -- Terminal prompt modifications --

# https://web.archive.org/web/20160704140739/http://ithaca.arpinum.org/2013/01/02/git-prompt.html
PS1="\$(__git_ps1 "[%s]")$PS1"

# Function to allow a user to arbitrarily set the terminal title to anything
# Example: `set-title this is title 1`
set-title() {
    # Set the PS1 title escape sequence; see "Customizing the terminal window title" here:
    # https://wiki.archlinux.org/index.php/Bash/Prompt_customization#Customizing_the_terminal_window_title
    TITLE="\[\e]2;$@\a\]"
    PS1=${PS1_BAK}${TITLE}
}

# Back up original PS1 Prompt 1 string when ~/.bashrc is first sourced upon bash opening
if [[ -z "$PS1_BAK" ]]; then # If length of this str is zero (see `man test`)
    PS1_BAK=$PS1
fi

# Set the title to a user-specified value if and only if TITLE_DEFAULT has been previously set and
# exported by the user. This can be accomplished as follows:
#   export TITLE_DEFAULT="my title"
#   . ~/.bashrc
# Note that sourcing the ~/.bashrc file is done automatically by bash each time you open a new bash
# terminal, so long as it is an interactive (use `bash -i` if calling bash directly) type terminal
if [[ -n "$TITLE_DEFAULT" ]]; then # If length of this is NONzero (see `man test`)
    set-title "$TITLE_DEFAULT"
fi
